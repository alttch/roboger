#!/usr/bin/env python3

import sys
import os
import importlib


mods = [
        'base64',
        'cherrypy',
        'configparser',
        'cryptography',
        'datetime',
        'email.mime.text',
        'filetype',
        'hashlib',
        'json',
        'logging',
        'sqlite3',
        'netaddr',
        'pyaltt',
        'platform',
        'queue',
        'requests',
        'sqlalchemy',
        'signal',
        'smtplib',
        'threading',
        'time',
        'traceback',
        'termcolor',
        'rapidtables',
        'uuid',
        'yaml'
    ]

if len(sys.argv)>1 and sys.argv[1] == 'install': install = True
else: install = False

for m in mods:
    print (m.ljust(20),end = '')
    try:
        importlib.import_module(m)
        print ('OK')
    except:
        print ('MISSING!')
        if install:
            if m == 'paho.mqtt.client': mod = 'paho-mqtt'
            elif m == 'yaml': mod = 'pyyaml'
            elif m == 'pyaltt': mod = 'pyaltt==0.2.4'
            elif m == 'PIL': mod = 'pillow'
            else: mod = m
            os.system('pip3 install %s' % mod)
            try:
                importlib.import_module(m)
            except:
                print('Failed to install, Aborting')
                sys.exit(1)
